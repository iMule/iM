<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>D3 Bar Chart</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
        .bar {
            fill: steelblue;
        }
        .bar:hover {
            fill: orange;
        }
        .axis-label {
            font-size: 12px;
        }
        .title {
            font-size: 16px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <script>
        // Set dimensions and margins for the chart
        const margin = {top: 20, right: 30, bottom: 40, left: 40},
              width = 800 - margin.left - margin.right,
              height = 400 - margin.top - margin.bottom;

        // Append SVG object to the body
        const svg = d3.select("body")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Parse the CSV file
        d3.csv("path/to/your/csvfile.csv").then(data => {
            // Transform the data to get counts for each combination of Industry, Position, and Death Type
            const nestedData = d3.rollups(data, v => v.length, d => d.Industry, d => d.Position, d => d['Death Type']);

            // Flatten the nested data structure for easier plotting
            const flatData = [];
            nestedData.forEach(([industry, positions]) => {
                positions.forEach(([position, deathTypes]) => {
                    deathTypes.forEach(([deathType, count]) => {
                        flatData.push({ industry, position, deathType, count });
                    });
                });
            });

            // Create scales
            const x = d3.scaleBand()
                .domain(flatData.map(d => `${d.industry} - ${d.position} - ${d.deathType}`))
                .range([0, width])
                .padding(0.1);

            const y = d3.scaleLinear()
                .domain([0, d3.max(flatData, d => d.count)])
                .range([height, 0]);

            // Add X axis
            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .selectAll("text")
                .attr("transform", "translate(-10,0)rotate(-45)")
                .style("text-anchor", "end");

            // Add Y axis
            svg.append("g")
                .call(d3.axisLeft(y));

            // Add bars
            svg.selectAll(".bar")
                .data(flatData)
                .enter()
                .append("rect")
                .attr("class", "bar")
                .attr("x", d => x(`${d.industry} - ${d.position} - ${d.deathType}`))
                .attr("y", d => y(d.count))
                .attr("width", x.bandwidth())
                .attr("height", d => height - y(d.count));

            // Add X axis label
            svg.append("text")
                .attr("class", "axis-label")
                .attr("text-anchor", "end")
                .attr("x", width / 2 + margin.left)
                .attr("y", height + margin.top + 30)
                .text("Industry - Position - Death Type");

            // Add Y axis label
            svg.append("text")
                .attr("class", "axis-label")
                .attr("text-anchor", "end")
                .attr("transform", "rotate(-90)")
                .attr("y", -margin.left + 20)
                .attr("x", -margin.top - height / 2 + 20)
                .text("Count");

            // Add title
            svg.append("text")
                .attr("class", "title")
                .attr("x", width / 2)
                .attr("y", -margin.top / 2)
                .attr("text-anchor", "middle")
                .text("Death Type by Industry and Position");
        });
    </script>
</body>
</html>
